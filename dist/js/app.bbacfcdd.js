(function(e){function t(t){for(var n,r,o=t[0],l=t[1],u=t[2],m=0,g=[];m<o.length;m++)r=o[m],Object.prototype.hasOwnProperty.call(s,r)&&s[r]&&g.push(s[r][0]),s[r]=0;for(n in l)Object.prototype.hasOwnProperty.call(l,n)&&(e[n]=l[n]);c&&c(t);while(g.length)g.shift()();return i.push.apply(i,u||[]),a()}function a(){for(var e,t=0;t<i.length;t++){for(var a=i[t],n=!0,o=1;o<a.length;o++){var l=a[o];0!==s[l]&&(n=!1)}n&&(i.splice(t--,1),e=r(r.s=a[0]))}return e}var n={},s={app:0},i=[];function r(t){if(n[t])return n[t].exports;var a=n[t]={i:t,l:!1,exports:{}};return e[t].call(a.exports,a,a.exports,r),a.l=!0,a.exports}r.m=e,r.c=n,r.d=function(e,t,a){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:a})},r.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var a=Object.create(null);if(r.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)r.d(a,n,function(t){return e[t]}.bind(null,n));return a},r.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="/";var o=window["webpackJsonp"]=window["webpackJsonp"]||[],l=o.push.bind(o);o.push=t,o=o.slice();for(var u=0;u<o.length;u++)t(o[u]);var c=l;i.push([0,"chunk-vendors"]),a()})({0:function(e,t,a){e.exports=a("56d7")},"034f":function(e,t,a){"use strict";var n=a("85ec"),s=a.n(n);s.a},"35e8":function(e,t,a){},"56d7":function(e,t,a){"use strict";a.r(t);a("e260"),a("e6cf"),a("cca6"),a("a79d");var n=a("2b0e"),s=a("8c4f"),i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{attrs:{id:"home"}},[a("MessageBoard")],1)},r=[],o=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{attrs:{id:"message-board"}},[a("el-container",{staticStyle:{height:"100%",border:"1px solid #eee"}},[a("el-header",{staticStyle:{"text-align":"right","font-size":"10px"}},[a("el-button",{staticStyle:{display:"inline-block","margin-right":"15px"},on:{click:function(t){e.postDialog.dialogVisible=!0}}},[a("i",{staticClass:"el-icon-edit"},[e._v("发表")])]),a("el-button",{staticStyle:{display:"inline-block","margin-right":"15px"}},[a("i",{staticClass:"el-icon-refresh",staticStyle:{"object-fit":"fill"},on:{click:function(t){return e.getAjax()}}},[e._v("刷新")])]),a("el-dropdown",{attrs:{trigger:"click"}},[a("el-button",[a("i",{staticClass:"el-icon-user",staticStyle:{"object-fit":"contain"}},[e.state.username_valid?a("span",[e._v(e._s(e.state.username))]):a("span",[e._v("匿名")])])]),a("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[e.state.username_valid?a("el-dropdown-item",[a("a",{on:{click:function(t){return e.clearUserName()}}},[e._v("注销")])]):e._e(),e.state.username_valid?a("el-dropdown-item",[a("a",{on:{click:function(t){e.loginDialog.dialogVisible=!0}}},[e._v("修改")])]):e._e(),e.state.username_valid?e._e():a("el-dropdown-item",[a("a",{on:{click:function(t){e.loginDialog.dialogVisible=!0}}},[e._v("设置")])])],1)],1)],1),a("el-main",[a("MessageList",{attrs:{messageList:this.messageList}})],1),a("el-footer",[e._v("@CST2021SE")])],1),e.postDialog.dialogVisible?[a("PostDialog",{attrs:{dialogVisible:!0,state:e.state},on:{changePostDialogData:e.changePost}})]:e._e(),e.loginDialog.dialogVisible?[a("LoginDialog",{attrs:{loginDialog:e.loginDialog,state:e.state,updateUsername:e.setUserName}})]:e._e(),a("el-dialog",{staticStyle:{"text-align":"center"},attrs:{title:e.alertDialog.text,visible:e.alertDialog.dialogVisible,width:"40%"},on:{"update:visible":function(t){return e.$set(e.alertDialog,"dialogVisible",t)}}})],2)},l=[],u=(a("96cf"),a("1da1")),c=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{attrs:{id:"message-list"}},e._l(e.messageList,(function(e){return a("li",{key:e.timestamp},[a("MessageBlock",{attrs:{title:e.title,message:e.message,user:e.user,timestamp:e.timestamp}})],1)})),0)},m=[],g=(a("cb29"),function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-menu",{staticStyle:{background:"#b0c7e7","border-radius":"4px",margin:"5px"},attrs:{"default-openeds":[]}},[a("el-submenu",{staticStyle:{"text-align":"left"},attrs:{index:"view"}},[a("template",{slot:"title"},[a("i",{staticClass:"el-icon-chat-square"}),e._v(" "+e._s(e.title)+" ")]),a("div",{staticStyle:{display:"flex","margin-top":"3px","font-size":"small",color:"grey"}},[a("span",{staticClass:"messageblock-datetime",staticStyle:{padding:"4px"}},[e._v(" "+e._s(e.transformTimeStamp(e.timestamp))+" ")]),a("span",{staticClass:"messageblock-user",staticStyle:{padding:"4px"}},[e._v(e._s(e.user))])]),a("div",{staticClass:"messageblock-content"},[e._v(e._s(e.message))])],2)],1)}),d=[],p=(a("a9e3"),a("ac1f"),a("5319"),{name:"MessageBlock",props:{title:{type:String,default:function(){return"unknown title"}},message:{type:String,default:function(){return"unknown content"}},user:{type:String,default:function(){return"unknown user"}},timestamp:{type:Number,default:function(){return 0}}},computed:{datetime:function(){var e=new Date;return e.setTime(this.timestamp),e.toLocaleString()}},methods:{transformTimeStamp:function(e){return new Date(1e3*parseInt(e)).toLocaleString().replace(/:\d{1,2}$/," ")}}}),f=p,h=(a("769f"),a("2877")),b=Object(h["a"])(f,g,d,!1,null,"7f97ff90",null),v=b.exports,_={name:"MessageList",components:{MessageBlock:v},props:{messageList:{type:Array,default:function(){return new Array(5).fill({title:"Hello",message:"Hello World!",user:"unknown",timestamp:(new Date).getTime()})}}}},x=_,w=Object(h["a"])(x,c,m,!1,null,null,null),y=w.exports,D=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-dialog",{staticStyle:{"text-align":"center"},attrs:{title:"发表",visible:e.dialogVisible,"show-close":!1,width:"80%"},on:{"update:visible":function(t){e.dialogVisible=t}}},[a("el-form",{attrs:{"label-width":"80px"}},[a("el-form-item",{attrs:{label:"标题"}},[a("el-input",{attrs:{placeholder:"title"},model:{value:e.title,callback:function(t){e.title=t},expression:"title"}})],1),a("el-form-item",{attrs:{label:"内容"}},[a("el-input",{attrs:{type:"textarea",placeholder:"message"},model:{value:e.message,callback:function(t){e.message=t},expression:"message"}})],1),a("el-form-item",{attrs:{label:"发帖名"}},[e.state.username_valid?a("el-input",{attrs:{disabled:!0,value:e.state.username}}):e._e(),!1===e.state.username_valid?a("span",{staticStyle:{color:"red"}},[e._v("请在主页右上设置名字!")]):e._e()],1)],1),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:e.changeData}},[e._v("取 消")]),a("el-button",{attrs:{type:"primary",disabled:!1===e.state.username_valid},on:{click:e.handleClose}},[e._v("确 定")])],1)],1)},k=[],j={name:"PostDialog",props:{dialogVisible:{type:Boolean,default:function(){return!0}},state:{type:Object,default:function(){return{username:"",username_valid:!1}}}},data:function(){return{title:"",message:""}},methods:{handleClose:function(){this.$emit("changePostDialogData",this.title,this.message)},changeData:function(){this.$emit("changePostDialogData",null,null)}}},S=j,O=Object(h["a"])(S,D,k,!1,null,null,null),$=O.exports,V=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-dialog",{staticStyle:{"text-align":"center"},attrs:{title:"设置发帖名",visible:e.loginDialog.dialogVisible,width:"40%"},on:{"update:visible":function(t){return e.$set(e.loginDialog,"dialogVisible",t)}}},[a("span",[e._v("这里不做登录校验，仅仅演示一个设置功能")]),a("el-form",{attrs:{model:e.loginDialog.form,"label-width":"80px"}},[""!==e.loginDialog.dialogError?a("span",{staticStyle:{color:"red"}},[e._v(e._s(e.loginDialog.dialogError))]):e._e(),e.state.username_valid?a("el-form-item",{attrs:{label:"原用户名"}},[a("el-input",{attrs:{disabled:"",value:e.state.username}})],1):e._e(),a("el-form-item",{attrs:{label:"用户名"}},[a("el-input",{attrs:{"aria-placeholder":e.state},model:{value:e.loginDialog.form.username,callback:function(t){e.$set(e.loginDialog.form,"username",t)},expression:"loginDialog.form.username"}})],1)],1),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){e.loginDialog.dialogVisible=!1}}},[e._v("返回")]),a("el-button",{attrs:{type:"primary",disabled:e.state.username_valid&&e.state.username===e.loginDialog.form.username},on:{click:e.setUserName}},[e.state.username_valid?a("span",[e._v("修改")]):a("span",[e._v("设置")])])],1)],1)},L=[],C={name:"LoginDialog",props:{loginDialog:{type:Object,default:function(){return{dialogVisible:!1,dialogError:"",form:{username:""}}}},state:{type:Object,default:function(){return{username:"",username_valid:!1}}},updateUsername:{type:Function,default:function(){return function(){}}}},methods:{setUserName:function(){this.$props.updateUsername(this.loginDialog.form.username)}}},M=C,P=Object(h["a"])(M,V,L,!1,null,"1e25646d",null),A=P.exports,E=(a("4d63"),a("25f0"),a("466d"),{getCookie:function(e,t){var a=new RegExp("(?:^|(?:; ))"+e+"=([^;]*)"),n=document.cookie.match(a);return console.log(n),n?unescape(n[1]):t},setCookie:function(e,t,a){var n=new Date;n.setTime(n.getTime()+a),document.cookie=e+"="+escape(t)+";expires="+n.toGMTString()}}),R=E,T={name:"MessageBoard",components:{LoginDialog:A,MessageList:y,PostDialog:$},data:function(){return{postDialog:{dialogVisible:!1},loginDialog:{dialogVisible:!1,dialogError:"",form:{username:""}},alertDialog:{text:"",dialogVisible:!1},state:{username:"",username_valid:!1},messageList:[]}},mounted:function(){this.getAjax()},methods:{getAjax:function(){var e=this;return Object(u["a"])(regeneratorRuntime.mark((function t(){var a,n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return a={data:{}},t.next=3,e.$axios.request_json(a);case 3:if(a=a.data,a){t.next=6;break}return t.abrupt("return");case 6:for(n in e.messageList=[],a)a[n].timestamp>1e11&&(a[n].timestamp/=1e3),a[n].user=unescape(a[n].user),e.messageList.push({title:a[n].title,message:a[n].content,user:a[n].user,timestamp:a[n].timestamp});e.$message("updated.");case 9:case"end":return t.stop()}}),t)})))()},changePost:function(e,t){var a=this;this.postDialog.dialogVisible=!1,null!=e&&this.$axios.send_json(e,t).then((function(e){a.getAjax(),a.$message(e)}))},clearUserName:function(){var e=this;return Object(u["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,R.setCookie("name",e.state.username,(new Date).getTime()-1e9);case 2:e.state.username="",e.state.username_valid=!1;case 4:case"end":return t.stop()}}),t)})))()},setUserName:function(e){var t=this;return Object(u["a"])(regeneratorRuntime.mark((function a(){return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return t.state.username=e,t.state.username_valid=!0,a.next=4,R.setCookie("name",e,(new Date).getTime()+1e9);case 4:t.loginDialog.dialogVisible=!1,t.loginDialog.form.username="";case 6:case"end":return a.stop()}}),a)})))()}},watch:{"state.username":{handler:function(e){this.state.username_valid=/^[A-Za-z\u4e00-\u9fa5][-A-Za-z0-9\u4e00-\u9fa5_]*$/.test(e)}}}},U=T,N=(a("7303"),Object(h["a"])(U,o,l,!1,null,"2a2b00a6",null)),B=N.exports,z={name:"Home",components:{MessageBoard:B}},q=z,H=Object(h["a"])(q,i,r,!1,null,null,null),Z=H.exports,J=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{attrs:{id:"stage1"}},[a("MessageBlock")],1)},F=[],G={name:"Stage1",components:{MessageBlock:v}},I=G,W=Object(h["a"])(I,J,F,!1,null,null,null),K=W.exports,Q=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{attrs:{id:"stage2"}},[a("MessageList")],1)},X=[],Y={name:"Stage2",components:{MessageList:y}},ee=Y,te=Object(h["a"])(ee,Q,X,!1,null,null,null),ae=te.exports,ne=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{attrs:{id:"stage3"}},[a("MessageList",{attrs:{messageList:this.messageList}}),e.dialogVisible?[a("PostDialog",{attrs:{dialogVisible:!0,state:e.state},on:{changePostDialogData:e.changePost}})]:e._e()],2)},se=[],ie={name:"Stage3",components:{MessageList:y,PostDialog:$},mounted:function(){R.setCookie("username","Alice",1e9),this.state.username="Alice",this.getAjax(),this.setUserName("Alice")},data:function(){return{messageList:[],dialogVisible:!0,state:{username:"",username_valid:!1}}},methods:{getAjax:function(){var e=this;return Object(u["a"])(regeneratorRuntime.mark((function t(){var a,n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return a={data:{}},t.next=3,e.$axios.request_json(a);case 3:if(a=a.data,a){t.next=6;break}return t.abrupt("return");case 6:for(n in e.messageList=[],a)a[n].timestamp>1e11&&(a[n].timestamp/=1e3),e.messageList.push({title:a[n].title,message:a[n].content,user:a[n].user,timestamp:a[n].timestamp});e.$message("updated.");case 9:case"end":return t.stop()}}),t)})))()},changePost:function(e,t){var a=this;this.dialogVisible=!1,null!=e&&this.$axios.send_json(e,t).then((function(e){a.getAjax(),a.$message(e)}))},setUserName:function(e){var t=this;return Object(u["a"])(regeneratorRuntime.mark((function a(){return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return t.state.username=e,t.state.username_valid=!0,a.next=4,R.setCookie("name",e,(new Date).getTime()+1e9);case 4:t.loginDialog.dialogVisible=!1,t.loginDialog.form.username="";case 6:case"end":return a.stop()}}),a)})))()}},watch:{"state.username":{handler:function(e){this.state.username_valid=/^[A-Za-z\u4e00-\u9fa5][-A-Za-z0-9\u4e00-\u9fa5_]*$/.test(e)}}}},re=ie,oe=Object(h["a"])(re,ne,se,!1,null,null,null),le=oe.exports;n["default"].use(s["a"]);var ue=[{path:"/",name:"Home",component:Z},{path:"/stage1",name:"Stage1",component:K},{path:"/stage2",name:"Stage2",component:ae},{path:"/stage3",name:"Stage3",component:le}],ce=new s["a"]({mode:"history",routes:ue}),me=ce,ge=a("5c96"),de=a.n(ge),pe=(a("0fae"),a("bc3a")),fe=a.n(pe);function he(e){return be.apply(this,arguments)}function be(){return be=Object(u["a"])(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.axios.get("/api/message").then((function(e){200==e.data["code"]?t.data=e.data["data"]:console.log("err")}),(function(e){console.log(e)}));case 2:case"end":return e.stop()}}),e,this)}))),be.apply(this,arguments)}function ve(e,t){return _e.apply(this,arguments)}function _e(){return _e=Object(u["a"])(regeneratorRuntime.mark((function e(t,a){var n,s;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return n={title:t,content:a},s="?",R.getCookie("name","Unknown"),e.next=5,this.axios.post("/api/message",JSON.stringify(n)).then((function(e){201!=e.data["code"]&&(s="发送失败"),s="发送成功"}),(function(e){console.log(e),s="发送失败"}));case 5:return e.abrupt("return",s);case 6:case"end":return e.stop()}}),e,this)}))),_e.apply(this,arguments)}fe.a.defaults.timeout=5e3,fe.a.defaults.headers.post["Content-Type"]="application/json",fe.a.defaults.withCredentials=!0;var xe={axios:fe.a,request_json:he,send_json:ve},we=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{attrs:{id:"app"}},[a("router-view")],1)},ye=[],De=(a("034f"),{}),ke=Object(h["a"])(De,we,ye,!1,null,null,null),je=ke.exports;n["default"].use(de.a),n["default"].config.productionTip=!1,n["default"].prototype.$axios=xe,new n["default"]({router:me,render:function(e){return e(je)},axios:xe}).$mount("#app")},7303:function(e,t,a){"use strict";var n=a("35e8"),s=a.n(n);s.a},"769f":function(e,t,a){"use strict";var n=a("b8c6"),s=a.n(n);s.a},"85ec":function(e,t,a){},b8c6:function(e,t,a){}});
//# sourceMappingURL=app.bbacfcdd.js.map